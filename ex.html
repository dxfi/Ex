<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Explorer Mini</title>
    <link rel="stylesheet" href="styles.css">
    <style>body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: #f4f4f9;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

table, th, td {
    border: 1px solid #ddd;
}

th, td {
    padding: 10px;
    text-align: left;
}

th {
    background-color: #007bff;
    color: white;
}

tr:nth-child(even) {
    background-color: #f9f9f9;
}

.status-success {
    color: green;
    font-weight: bold;
}

.status-pending {
    color: orange;
    font-weight: bold;
}

td, th {
    border-right: 1px solid #ddd;
}

td:last-child, th:last-child {
    border-right: none;
}</style>
</head>
<body>
    <h1>Riwayat Minting Token</h1>
    <table>
        <thead>
            <tr>
                <th>TxID</th>
                <th>Alamat Penerima</th>
                <th>Jumlah (Token)</th>
                <th>Waktu Transaksi</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="transaction-table">
            <!-- Data dari JS akan muncul di sini -->
        </tbody>
    </table>

    <!-- Mengimpor Web3.js dari CDN -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
    <script>// Pastikan Anda sudah mengganti dengan URL Infura Anda atau node Ethereum lainnya
const web3 = new Web3('https://opbnb-testnet.infura.io/v3/370f6b9b5d1542ae828ad89d7566dbdf');

// Alamat kontrak token dan ABI kontrak
const contractAddress = "0x01ca226f0d215f6877df1d1c50791cdb0743e2e3"; // Ganti dengan alamat kontrak token Anda
const contractABI = [{"inputs":[{"internalType":"address payable","name":"_taxCollector","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"EtherWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokenBurned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"taxPaid","type":"uint256"}],"name":"TokenMinted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokensWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"BURN_PERCENTAGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"NET_TAX_PER_1000","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TOKENS_PER_MINT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"newTaxCollector","type":"address"}],"name":"changeTaxCollector","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"mintToken","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"taxCollector","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawEther","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawTokens","outputs":[],"stateMutability":"nonpayable","type":"function"}]; // Ganti dengan ABI kontrak token Anda

// Membuat instance kontrak token
const contract = new web3.eth.Contract(contractABI, contractAddress);

// Fungsi untuk mendapatkan riwayat minting dalam real-time
async function fetchMintingHistory() {
    const tableBody = document.getElementById("transaction-table");

    try {
        // Mendapatkan event Transfer yang menunjukkan minting
        const events = await contract.getPastEvents('Transfer', {
            fromBlock: 0, // Blok awal untuk mengambil event
            toBlock: 'latest', // Blok terbaru
        });

        events.forEach(event => {
            const { transactionHash, returnValues } = event;
            const row = document.createElement("tr");

            row.innerHTML = `
                <td>${transactionHash}</td>
                <td>${returnValues.to}</td>
                <td>${web3.utils.fromWei(returnValues.value, 'ether')}</td>
                <td>${new Date().toISOString()}</td> <!-- Waktu transaksi -->
                <td class="status-success">Success</td> <!-- Status minting sukses -->
            `;

            tableBody.appendChild(row);
        });
    } catch (error) {
        console.error("Error fetching minting history:", error);
    }
}

// Fungsi untuk memantau event Transfer secara real-time
function watchRealTimeEvents() {
    contract.events.Transfer({
        fromBlock: 'latest' // Mulai memantau dari blok terbaru
    })
    .on('data', event => {
        const { transactionHash, returnValues } = event;
        const tableBody = document.getElementById("transaction-table");
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${transactionHash}</td>
            <td>${returnValues.to}</td>
            <td>${web3.utils.fromWei(returnValues.value, 'ether')}</td>
            <td>${new Date().toISOString()}</td> <!-- Waktu transaksi -->
            <td class="status-success">Success</td> <!-- Status minting sukses -->
        `;

        tableBody.appendChild(row);
    })
    .on('error', console.error);
}

// Memanggil fungsi untuk memuat data awal dan memantau event secara real-time
fetchMintingHistory();
watchRealTimeEvents();</script>
</body>
</html>
