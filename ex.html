<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minting History</title>
    <style>/* Reset default styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Global styles */
body {
    font-family: 'Roboto', sans-serif;
    background-color: rgba(0, 0, 0, 0.05); /* Transparent background */
    color: #333;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
    text-align: center;
}

h1 {
    font-size: 2.5rem;
    color: #00BFFF; /* Modern blue color */
    margin-bottom: 20px;
    font-weight: 600;
}

/* Container for the minting history */
#historyContainer {
    width: 100%;
    max-width: 800px;
    background-color: rgba(255, 255, 255, 0.9); /* Semi-transparent white background */
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    padding: 20px;
    overflow-y: auto;
}

/* Styling for each minting history item */
#historyContainer div {
    background-color: rgba(240, 240, 240, 0.9);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

p {
    font-size: 1.1rem;
    color: #444;
    margin-bottom: 8px;
}

/* Styling for links */
a {
    text-decoration: none;
    color: #00BFFF;
    font-weight: bold;
}

a:hover {
    color: #FF4500; /* Change color on hover */
}

/* Styling for transaction hash links */
hr {
    margin: 20px 0;
    border: 0;
    border-top: 2px solid #ddd;
}

/* Responsive design for smaller screens */
@media (max-width: 600px) {
    h1 {
        font-size: 2rem;
    }

    p {
        font-size: 1rem;
    }

    #historyContainer {
        padding: 15px;
    }
}</style>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
    <h1>Minting History</h1>
    <div id="historyContainer"></div>

    <script>
        // URL RPC jaringan (ganti dengan RPC jaringan Anda, misalnya dari Infura atau Alchemy)
        const RPC_URL = "https://opbnb-testnet-rpc.bnbchain.org"; // Ubah dengan RPC Anda
        const web3 = new Web3(new Web3.providers.HttpProvider(RPC_URL));

        // Alamat kontrak Anda
        const CONTRACT_ADDRESS = "0x01ca226f0d215f6877df1d1c50791cdb0743e2e3"; // Ganti dengan alamat kontrak Anda

        // ABI kontrak Anda
        const CONTRACT_ABI = [{"inputs":[{"internalType":"address payable","name":"_taxCollector","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"EtherWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokenBurned","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"taxPaid","type":"uint256"}],"name":"TokenMinted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokensWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"BURN_PERCENTAGE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"NET_TAX_PER_1000","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"TOKENS_PER_MINT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"newTaxCollector","type":"address"}],"name":"changeTaxCollector","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"mintToken","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"taxCollector","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawEther","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawTokens","outputs":[],"stateMutability":"nonpayable","type":"function"}];

        // Inisialisasi kontrak
        const contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);

        // Fungsi untuk mengambil riwayat minting
        async function fetchMintingHistory() {
            try {
                // Ambil semua event Transfer dari blok awal sampai blok terbaru
                const events = await contract.getPastEvents('Transfer', {
                    fromBlock: 0, // Mulai dari blok genesis
                    toBlock: 'latest' // Sampai blok terakhir
                });

                console.log("Riwayat Minting (Transfer Events):", events);

                // Format data event untuk ditampilkan
                const formattedEvents = events.map(event => ({
                    from: event.returnValues.from,
                    to: event.returnValues.to,
                    value: web3.utils.fromWei(event.returnValues.value, 'ether'), // Konversi ke Ether
                    blockNumber: event.blockNumber,
                    transactionHash: event.transactionHash
                }));

                // Tampilkan data di konsol
                console.table(formattedEvents);

                // Jika ingin menampilkan di UI, gunakan DOM
                const historyContainer = document.getElementById("historyContainer");
                if (historyContainer) {
                    historyContainer.innerHTML = formattedEvents.map(event => `
                        <div>
                            <p>From: ${event.from}</p>
                            <p>To: ${event.to}</p>
                            <p>Amount: ${event.value} AI</p>
                            <p>Block: ${event.blockNumber}</p>
                            <p>Transaction: <a href="https://opbnb-testnet.bscscan.com/tx/${event.transactionHash}" target="_blank">${event.transactionHash}</a></p>
                        </div>
                        <hr>
                    `).join("");
                }
            } catch (error) {
                console.error("Error fetching minting history:", error);
            }
        }

        // Panggil fungsi untuk mengambil riwayat minting
        fetchMintingHistory();
    </script>
</body>
</html>
